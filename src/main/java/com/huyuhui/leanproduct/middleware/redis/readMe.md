redis知识

# 杂
分布式锁

redis数据结构

考虑用注解方式实现锁

# 问题

### 问题：页面没有对操作按钮做限制导致操作接口调用两遍

通过redis的setnx来实现

### 问题：在底层项目，有时候会需要在不同层获取同一个锁，而setnx是不支持这种可重复锁的，所以需要自己写lua脚本来解决
之前同事遇到了这个问题，但是之后同事可能优化了代码没用上了，所以我也没有见过在实际业务上用到的地方，不过这种运行lua脚本的方式还是可以学习的



> 在删除key之前，一定要判断服务A持有的value与Redis内存储的value是否一致。如果贸然使用服务A持有的key来删除锁，则会误将服务B的锁释放掉。

为什么A服务不能删除B服务的锁？我在实际运用中没有对锁的删除做客户端校验，概念我懂，就是为了确保锁的安全性，所以这个要求算是一个规范，平时使用是默认遵守不会乱删的，毕竟要校验的话也会多一步很麻烦，对于小体量的服务而言这样可能会增加复杂度，对于大型微服务，这则是必要做的

## 剩余的地方

集群：没用过，先不管

数据结构：平常用的最多的就是字符串，顶多就是列表，其他没用上

底层原理：为什么会这么快